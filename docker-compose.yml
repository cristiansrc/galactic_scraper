services:
  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"
      - "15672:15672"  # interfaz web de administraci√≥n
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: admin
    volumes:
      - ./rabbitmq_data:/var/lib/rabbitmq
    networks:
      - galactic_net

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: galactic_db
      POSTGRES_USER: galactic_user
      POSTGRES_PASSWORD: secret
    ports:
      - "5432:5432"  # Puerto externo 5432, interno 5432
    volumes:
      - ./pgdata:/var/lib/postgresql/data
      - ./db/init_db.sql:/docker-entrypoint-initdb.d/init_db.sql
    networks:
      - galactic_net

  producer:
    build: ./producer
    env_file:
      - .env
    depends_on:
      - rabbitmq
      - postgres
    environment:
      - RABBITMQ_HOST=rabbitmq
      - POSTGRES_HOST=postgres
      - POSTGRES_DB=galactic_db
      - POSTGRES_USER=galactic_user
      - POSTGRES_PASSWORD=secret
      - RABBITMQ_USER=admin
      - RABBITMQ_PASSWORD=admin
    networks:
      - galactic_net

  agent:
    env_file:
      - .env
    build: ./agent
    depends_on:
      - rabbitmq
      - postgres
    environment:
      - RABBITMQ_HOST=rabbitmq
      - POSTGRES_HOST=postgres
      - POSTGRES_DB=galactic_db
      - POSTGRES_USER=galactic_user
      - POSTGRES_PASSWORD=secret
      - RABBITMQ_USER=admin
      - RABBITMQ_PASSWORD=admin
    networks:
      - galactic_net

networks:
  galactic_net: